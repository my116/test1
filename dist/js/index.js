var projectB=angular.module("projectB",["ngRoute","ngAnimate","angular-timedropper"]);
projectB.directive("repeatFinish",function(){return{link:function(e,t,i){1==e.$last&&(console.log("ng-repeat执行完毕"),e.$eval(i.repeatFinish))}}}).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,i,n,o){var r=e(n.fileModel),c=r.assign;i.bind("change",function(e){t.$apply(function(){c(t,i[0].files[0])}),t.file=(e.srcElement||e.target).files[0],t.getFile(t.file)})}}}]).directive("barCharts",function(){return{restrict:"AE",scope:{source:"="},replace:!0,template:'<div id="dayBusinessEchart" style="height:400px;width:800px;"></div>',controller:function(e){},link:function(e,t,i){var n={title:{text:"日营业报表"},tooltip:{},legend:{data:["金额"]},xAxis:{data:["按摩","踩背","掏耳","洗脚","红牛","水饺","汤圆"]},yAxis:{},series:[{name:"金额",type:"bar",data:[900,9e3,3483,23242,23424,23423,1323]}]},o=echarts.init(document.getElementById("dayBusinessEchart"));o.setOption(n)}}}).directive("echarts",function(){return{restrict:"AE",scope:{eid:"@id",option:"="},replace:!1,template:"",link:function(e,t,i){console.log(e.option);var n=echarts.init(document.getElementById(e.eid));console.log(n),n.setOption(e.option),e.$watch("option",function(e,t,i){n.setOption(i.option)},!0)}}});
projectB.filter("filterTime",function(){return function(e,t,r){var n="",i="",u="",f="",c="",a="",o="";e*=1e3;var l=new Date;if(l.setTime(e),i=l.getFullYear(),u=l.getMonth()+1,f=l.getDate(),c=l.getHours(),a=l.getMinutes(),o=l.getSeconds(),!t)var t="-";return n+="YY-MM-DD"==r?i+t+u+t+f:"hh-mm-ss"==r?c+":"+a+":"+o:i+t+u+t+f+" "+c+":"+a+":"+o}}).filter("filterSex",function(){return function(e){var t="";return t="1"==e?"男":"女",t="1"==e?"男":"2"==e?"女":"未知"}}).filter("filterTechnicianState",function(){return function(e){var t="";return t="1"==e?"空闲":"2"==e?"忙碌":"3"==e?"请假":"4"==e?"锁定":"异常"}}).filter("filterTechnicianFor",function(){return function(e){var t="";if("无"==e)t="无";else{var r=e.split("/",2);t="房间:"+r[0]+", 手牌:"+r[1]}return t}});

projectB.config(["$routeProvider",function(e){e.when("/cashier",{templateUrl:"/Public/Home/view/cashier.html",controller:"CashierController"}).when("/technician",{templateUrl:"/Public/Home/view/technician.html",controller:"TechnicianController"}).when("/finance",{templateUrl:"/Public/Home/view/finance.html",controller:"FinanceController"}).when("/member",{templateUrl:"/Public/Home/view/member.html",controller:"MemberController"}).when("/goods",{templateUrl:"/Public/Home/view/goods.html",controller:"GoodsController"}).when("/system",{templateUrl:"/Public/Home/view/system.html",controller:"SystemController"}).when("/exit",{template:"退出系统"}).otherwise({redirectTo:"/cashier"})}]);
projectB.factory("fileReader",["$q","$log",function(r,n){var e=function(r,n,e){return function(){e.$apply(function(){n.resolve(r.result)})}},t=function(r,n,e){return function(){e.$apply(function(){n.reject(r.result)})}},o=function(r,n){var o=new FileReader;return o.onload=e(o,r,n),o.onerror=t(o,r,n),o},a=function(n,e){console.log(n);var t=r.defer(),a=o(t,e);return a.readAsDataURL(n),t.promise};return{readAsDataUrl:a}}]).factory("echarts",function(){return echarts});
projectB.controller("CashierController",["$scope","$http","$rootScope",function(o,n,e){var r=[];o.roomsEmpty=[],o.rooms=[],o.refreshRoomsData=function(){n.get("http://"+e.myHost+"/Home/Index/GetRooms").success(function(n){o.roomsEmpty=[],o.rooms=[],r=n.data,console.log("获得的数据",r);for(var e=[],t=0,s=n.data.length;t<s;t++)n.data[t]&&(t%9==0&&(e=[]),e.push(n.data[t]),9==e.length&&o.rooms.push(e)),4==n.data[t].state&&o.roomsEmpty.push(n.data[t]);9!=e.length&&o.rooms.push(e),console.log(o.rooms)})},o.refreshRoomsData(),o.$parent.changeHeaderInfo("roomPageIndex"),o.roomAppointment=!1,o.roomUsing=!1,o.roomPageShow=[!0,!1],o.cashierAlertView={changeRoomNumberView:!1,continueAddUserhandView:!1,chargebackView:!1,checkOutServiceView:!1,addConsumptionView:!1,roomAppointmentInfoView:!1,cancelRoomAppointment:!1,addConsumptionTechnicianView:!1},o.roomMouseover=function(n,e){o.rooms[n][e].roomHover=!0},o.roomMouseleave=function(n,e){o.rooms[n][e].roomHover=!1},o.roomAppointmentInfo={roomNumber:"",roomID:"",userName:"",userPhone:"",userRemark:"",time:""},o.roomAppointmentErr={userName:!1,userPhone:!1,time:!1},o.showRoomAppointment=function(n,r){e.maskLayer=!0,o.roomAppointment=!0,o.roomAppointmentInfo.roomID=n,o.roomAppointmentInfo.roomNumber=r,e.disabledMouseWheel()},o.makeRoomAppointment=function(){var r=document.getElementById("appointmentTime");o.roomAppointmentInfo.time=r.value,console.log(o.roomAppointmentInfo);var t=/^1\d{10}$/,s=new Date;if(o.roomAppointmentInfo.time){var d=o.roomAppointmentInfo.time.split(" ")[0].split("-")[0],i=o.roomAppointmentInfo.time.split(" ")[0].split("-")[1]-1,a=o.roomAppointmentInfo.time.split(" ")[0].split("-")[2],c=o.roomAppointmentInfo.time.split(" ")[1].split(":")[0],m=o.roomAppointmentInfo.time.split(" ")[1].split(":")[1],u=o.roomAppointmentInfo.time.split(" ")[1].split(":")[2],f=new Date(d,i,a,c,m,u);o.roomAppointmentErr.time=f.getTime()-s<0}else o.roomAppointmentErr.time=!0;if(o.roomAppointmentErr.userName=""==o.roomAppointmentInfo.userName.trim(),o.roomAppointmentErr.userPhone=!t.test(o.roomAppointmentInfo.userPhone),console.log(s,s.getTime(),f),o.roomAppointmentErr.userName||o.roomAppointmentErr.userPhone||o.roomAppointmentErr.time);else{var I=o.roomAppointmentInfo;n({method:"POST",url:"http://"+e.myHost+"/Home/Index/MakeAnAppointment",data:I,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(n){console.log("预约房间请求返回数据",n),"SUCCESS"==n.state?(alert("房间预约成功"),o.closeRoomAppointment()):alert("房间预约失败")}).error(function(){alert("发生错误，请稍后再试")})}},o.closeRoomAppointment=function(){e.maskLayer=!1,o.roomAppointment=!1,o.roomAppointmentInfo={roomNumber:"",roomID:"",userName:"",userPhone:"",userRemark:"",time:""},console.log("关闭界面重置roomAppointmentInfo后的roomAppointmentInfo信息",o.roomAppointmentInfo),o.roomAppointmentErr.userName=!1,o.roomAppointmentErr.userPhone=!1,o.roomAppointmentErr.time=!1,e.ableMouseWheel(),o.refreshRoomsData()},o.roomUsingInfo={roomNumber:"",roomID:"",roomCount:"",userHands:[],userHandsID:[],newUserHand:""},o.roomUsingErr={isErr:!1,errInfo:"* 手牌号有误",errCode:""},o.showRoomUsing=function(n,r,t){e.maskLayer=!0,o.roomUsing=!0,o.roomUsingInfo.roomID=n,o.roomUsingInfo.roomNumber=r,o.roomUsingInfo.roomCount=t},o.roomUsingErrReset=function(){o.roomUsingErr.isErr=!1,o.roomUsingErr.errInfo="",o.roomUsingErr.errCode=""},o.addUserHand=function(){var r=/^[a-zA-Z0-9]{1,}$/;if(!r.test(o.roomUsingInfo.newUserHand))return o.roomUsingErrReset(),o.roomUsingErr.isErr=!0,void(o.roomUsingErr.errInfo="* 手牌号错误~");if(o.roomUsingInfo.userHands.length>=0+o.roomUsingInfo.roomCount)return o.roomUsingErrReset(),o.roomUsingErr.isErr=!0,void(o.roomUsingErr.errInfo="* 房间人数已满，无法继续添加手牌");for(var t=!0,s=0,d=o.roomUsingInfo.userHands.length;s<d;s++)o.roomUsingInfo.userHands[s]==o.roomUsingInfo.newUserHand&&(t=!1);t?n({method:"POST",url:"http://"+e.myHost+"/Home/Index/CheckUserHand",data:{userHand:o.roomUsingInfo.newUserHand},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n,e){console.log("获得手牌号是否能被添加",n),"SUCCESS"==n.state?(o.roomUsingInfo.userHands.push(o.roomUsingInfo.newUserHand),o.roomUsingInfo.userHandsID.push(n.data.handid),o.roomUsingErrReset(),o.roomUsingInfo.newUserHand=""):(o.roomUsingErr.errInfo="* "+n.errormsg,o.roomUsingErr.isErr=!0)}).error(function(){alert("发生错误，请稍后再试")}):(o.roomUsingErr.errInfo="* 手牌号错误",o.roomUsingErr.isErr=!0)},o.isAddUserHand=function(n){var e=window.event?n.keyCode:n.which;13==e&&(o.addUserHand(),n.preventDefault?n.preventDefault():n.returnValue=!1)},o.deleteUserHand=function(n){for(var e=0,r=o.roomUsingInfo.userHands.length;e<r;e++)o.roomUsingInfo.userHands[e]==n&&(o.roomUsingInfo.userHands.splice(e,1),o.roomUsingInfo.userHandsID.splice(e,1));console.log("删除后某个手牌后，手牌信息"+o.roomUsingInfo)},o.makeRoomUsing=function(){if(o.roomUsingInfo.userHands.length<1)return void(o.roomUsingErr.nobody=!0);var r={roomID:o.roomUsingInfo.roomID,userHands:o.roomUsingInfo.userHandsID};n({method:"POST",url:"http://"+e.myHost+"/Home/Index/RoomAddUser",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(r){if(console.log("发送开放请求获得的数据",r),"SUCCESS"==r.state){n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetRoomInfo",data:{roomID:o.roomUsingInfo.roomID},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n,e){o.roomOccupyInfo=n;for(var r=0,t=o.roomOccupyInfo.roomHandsInfo.length;r<t;r++)o.selectHandsInfo.userHandSelected[r]=!0}).error(function(){console.log("发生错误，请刷新！")});for(var t=!0,s=[],d=0,i=r.data.length;d<i;d++)"ERROR"==r.data[d].state&&(t=!1,s.push(r.data[d].handname));if(t)o.showRoomOccupyInfo(o.roomUsingInfo.roomID),o.closeRoomUsing(),o.isUnableClickAddConsumption(),console.log(o.roomUsingInfo);else{o.continueAddUserhandInfo.roomNumber=o.roomOccupyInfo.roomNumber,o.continueAddUserhandInfo.roomID=o.roomOccupyInfo.roomID,o.continueAddUserhandInfo.roomCount=o.roomOccupyInfo.roomCount,o.continueAddUserhandInfo.userHands=[],o.continueAddUserhandInfo.newUserHands=[];for(var d=0,i=o.roomOccupyInfo.roomHandsInfo.length;d<i;d++)o.continueAddUserhandInfo.userHands.push(o.roomOccupyInfo.roomHandsInfo[d].userHand);o.continueAddUserhandErr.errInfo="* ";for(var d=0,i=s.length;d<i;d++)o.continueAddUserhandErr.errInfo+=s[d]+",";o.continueAddUserhandErr.errInfo+="添加失败",o.continueAddUserhandErr.isErr=!0}}}).error(function(){console.log("开启房间失败，请稍后再试")})},o.closeRoomUsing=function(){e.maskLayer=!1,o.roomUsing=!1,o.roomUsingInfo={roomNumber:"",roomID:"",roomCount:"",userHands:[],userHandsID:[],newUserHand:""},o.roomUsingErrReset()},o.resetRoomAppointmentInformation=function(){o.roomAppointmentInformation={roomID:"",roomName:"",roomBed:"",userName:"",userTel:"",time:"",remarks:""}},o.resetRoomAppointmentInformation(),o.showRoomAppointmentInfoView=function(r,t,s){e.maskLayer=!0,o.cashierAlertView.roomAppointmentInfoView=!0,n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetMakeAnAppointment",data:{id:r},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(n){console.log("获取房间预约详情数据",n),"SUCCESS"==n.state?(o.roomAppointmentInformation.roomID=r,o.roomAppointmentInformation.roomName=t,o.roomAppointmentInformation.roomBed=s,o.roomAppointmentInformation.userName=n.data.guestname,o.roomAppointmentInformation.userTel=n.data.phone,o.roomAppointmentInformation.time=n.data.times,o.roomAppointmentInformation.remarks=n.data.content,console.log(o.roomAppointmentInformation)):alert("发生错误，请稍后再试")}).error(function(o){alert("发生错误,请稍后再试")})},o.closeRoomAppointmentInfoView=function(){e.maskLayer=!1,o.cashierAlertView.roomAppointmentInfoView=!1,o.resetRoomAppointmentInformation()},o.appointmentToUsing=function(){var n=o.roomAppointmentInformation.roomID,e=o.roomAppointmentInformation.roomName,r=o.roomAppointmentInformation.roomBed;o.closeRoomAppointmentInfoView(),o.showRoomUsing(n,e,r)},o.cancelRoomAppointment=function(){o.cashierAlertView.cancelRoomAppointment=!0},o.makeCancelRoomAppointment=function(){n({method:"POST",url:"http://"+e.myHost+"/Home/Index/CalcelMakeAnAppointment",data:{id:o.roomAppointmentInformation.roomID},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(n){console.log("取消房间预约返回数据",n),"SUCCESS"==n.state?(alert("取消房间预约成功"),o.closeCancelRoomAppointment(),o.closeRoomAppointmentInfoView(),o.refreshRoomsData()):alert("发生错误，请稍后再试")}).error(function(o){alert("发生错误,请稍后再试")})},o.closeCancelRoomAppointment=function(){o.cashierAlertView.cancelRoomAppointment=!1},o.unableClickAddConsumption=!0,o.isUnableClickAddConsumption=function(){for(var n=0,e=0,r=o.selectHandsInfo.userHandSelected.length;e<r;e++)o.selectHandsInfo.userHandSelected[e]&&(n++,o.roomOccupyInfo.userHand=o.roomOccupyInfo.roomHandsInfo[e].userHand,o.roomOccupyInfo.userHandID=o.roomOccupyInfo.roomHandsInfo[e].handid);1!==n?o.unableClickAddConsumption=!0:o.unableClickAddConsumption=!1},o.roomOccupyInfo={roomNumber:"",roomID:"",roomCount:"",roomStartTime:"",roomHandsInfo:"",userHand:"",userHandID:""},o.showRoomOccupyInfo=function(r){o.$parent.changeHeaderInfo("roomPageOccupy"),n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetRoomInfo",data:{roomID:r},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n,e){console.log("getRoomInfo",n),o.roomOccupyInfo=n,o.roomPageShow[0]=!1,o.roomPageShow[1]=!0;for(var r=0,t=o.roomOccupyInfo.roomHandsInfo.length;r<t;r++)o.selectHandsInfo.userHandSelected[r]=!0;o.isUnableClickAddConsumption()}).error(function(){})},o.selectUserHand=function(n){o.selectHandsInfo.userHandSelected[n]=!o.selectHandsInfo.userHandSelected[n],o.isUnableClickAddConsumption()},o.selectHandsInfo={userHandSelected:[]},o.resetRoomPageShow=function(){o.roomPageShow[0]=!0,o.roomPageShow[1]=!1},o.$on("callCashierBack",function(){o.resetRoomPageShow(),o.unableClickAddConsumption=!0,o.selectHandsInfo.userHandSelected=[],o.refreshRoomsData()}),o.resetAddConsumptionInfo=function(){o.addConsumptionInfo={roomID:"",userHand:"",userHandID:"",goodsKindsList:[],selectGoodsKind:"",selectGoodsKindName:"",searchText:"",allGoodsList:[],selectedGoodsList:[],selectTechnicianInfo:{selectTechnicianList:[],goodsName:"",goodsID:"",goodsPrice:"",searchText:"",technicianID:"",technicianName:""}}},o.resetAddConsumptionInfo(),o.showAddConsumptionView=function(){console.log("增加消费界面显示时，addConsumptionInfo",o.addConsumptionInfo),o.unableClickAddConsumption||(o.addConsumptionInfo.roomID=o.roomOccupyInfo.roomID,o.addConsumptionInfo.userHand=o.roomOccupyInfo.userHand,o.addConsumptionInfo.userHandID=o.roomOccupyInfo.userHandID,e.maskLayer=!0,o.cashierAlertView.addConsumptionView=!0,n.post("http://"+e.myHost+"/Home/Index/GetProductCategory").success(function(n){console.log("获取商品分类列表数据",n),o.addConsumptionInfo.goodsKindsList=n.data}).error(function(o){console.log(o),alert("网络故障！稍后再试")}),n.post("http://"+e.myHost+"/Home/Index/GetProducts").success(function(n){console.log("获取全部商品数据",n),"SUCCESS"==n.state&&(o.addConsumptionInfo.allGoodsList=n.data)}).error(function(o){console.log(o),alert("网络故障！稍后再试")}))},o.closeAddConsumptionView=function(){e.maskLayer=!1,o.cashierAlertView.addConsumptionView=!1;var r=o.addConsumptionInfo.userHand,t=o.addConsumptionInfo.userHandID;o.resetAddConsumptionInfo(),o.closeSelectTechnician(),n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetRoomInfo",data:{roomID:o.roomOccupyInfo.roomID},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n){console.log("getRoomInfo",n),o.roomOccupyInfo=n,o.roomOccupyInfo.userHand=r,o.roomOccupyInfo.userHandID=t;for(var e=0,s=n.roomHandsInfo.length;e<s;e++)o.roomOccupyInfo.userHandID==n.roomHandsInfo[e].handid?o.selectHandsInfo.userHandSelected[e]=!0:o.selectHandsInfo.userHandSelected[e]=!1;o.isUnableClickAddConsumption()}).error(function(){})},o.filterAddConsumptionGoods=function(){if(""==o.addConsumptionInfo.selectGoodsKind)o.addConsumptionInfo.selectGoodsKindName="";else for(var n=0,e=o.addConsumptionInfo.goodsKindsList.length;n<e;n++)if(o.addConsumptionInfo.goodsKindsList[n].id==o.addConsumptionInfo.selectGoodsKind){o.addConsumptionInfo.selectGoodsKindName=o.addConsumptionInfo.goodsKindsList[n].catename;break}var r={catename:o.addConsumptionInfo.selectGoodsKindName,pname:o.addConsumptionInfo.searchText};return r},o.addConsumption=function(r,t,s,d,i){if(r>0)o.cashierAlertView.addConsumptionTechnicianView=!0,o.addConsumptionInfo.selectTechnicianInfo.goodsName=s,o.addConsumptionInfo.selectTechnicianInfo.goodsID=d,o.addConsumptionInfo.selectTechnicianInfo.goodsPrice=i,n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetTccList",data:{category:t},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(n){console.log("增加服务时所属技师数据",n),"SUCCESS"==n.state&&(o.addConsumptionInfo.selectTechnicianInfo.selectTechnicianList=n.data)}).error(function(){alert("获取技师列表错误，请稍后再试")});else{for(var a=0,c=o.addConsumptionInfo.selectedGoodsList.length;a<c;a++)if(d==o.addConsumptionInfo.selectedGoodsList[a].id)return void o.addConsumptionInfo.selectedGoodsList[a].number++;var m={id:d,name:s,price:i,number:"1",state:"1"};o.addConsumptionInfo.selectedGoodsList.push(m)}},o.removeConsumption=function(n){for(var e=0,r=o.addConsumptionInfo.selectedGoodsList.length;e<r;e++)if(n==o.addConsumptionInfo.selectedGoodsList[e].id)return void o.addConsumptionInfo.selectedGoodsList.splice(e,1)},o.changeSelectedGoodsNumber=function(n,e){if(e)o.addConsumptionInfo.selectedGoodsList[n].number++;else{if(o.addConsumptionInfo.selectedGoodsList[n].number<=1)return;o.addConsumptionInfo.selectedGoodsList[n].number--}},o.selectTechnician=function(n,e,r){"1"==e&&(o.addConsumptionInfo.selectTechnicianInfo.technicianID=n,o.addConsumptionInfo.selectTechnicianInfo.technicianName=r)},o.makeSelectTechnician=function(){if(""==o.addConsumptionInfo.selectTechnicianInfo.technicianID)return void alert("请选择技师");for(var n=0,e=o.addConsumptionInfo.selectedGoodsList.length;n<e;n++)if(o.addConsumptionInfo.selectTechnicianInfo.goodsID==o.addConsumptionInfo.selectedGoodsList[n].id)return void alert("已经添加该项目");var r={id:o.addConsumptionInfo.selectTechnicianInfo.goodsID,name:o.addConsumptionInfo.selectTechnicianInfo.goodsName,price:o.addConsumptionInfo.selectTechnicianInfo.goodsPrice,number:1,state:"2",tid:o.addConsumptionInfo.selectTechnicianInfo.technicianID,tname:o.addConsumptionInfo.selectTechnicianInfo.technicianName};o.addConsumptionInfo.selectedGoodsList.push(r),o.closeSelectTechnician()},o.makeAddConsumption=function(){for(var r=[],t=0,s=o.addConsumptionInfo.selectedGoodsList.length;t<s;t++)if("1"==o.addConsumptionInfo.selectedGoodsList[t].state){var d={pid:o.addConsumptionInfo.selectedGoodsList[t].id,number:o.addConsumptionInfo.selectedGoodsList[t].number};r.push(d)}else if("2"==o.addConsumptionInfo.selectedGoodsList[t].state){var d={state:!0,pid:o.addConsumptionInfo.selectedGoodsList[t].id,tid:o.addConsumptionInfo.selectedGoodsList[t].tid};r.push(d)}var i={roomid:o.addConsumptionInfo.roomID,handid:o.addConsumptionInfo.userHandID,product:r};console.log(i),n({method:"POST",url:"http://"+e.myHost+"/Home/Index/RoomAddConsumption",data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(n){if(console.log("增加服务请求返回数据",n),"SUCCESS"==n.state){for(var e=0,r=n.PadMsgPush;e<r;e++)for(var t=0,s=n.PadMsgPush[e].length;t<s;t++)"SUCCESS"!=n.PadMsgPush[e][t].state&&alert(n.PadMsgPush[e][t].padname+"信息推送失败！");for(var d=[],e=0,r=n.info.length;e<r;e++)if("SUCCESS"==n.info[e].state)o.removeConsumption(n.info[e].pid);else if("303"==n.info[e].tcccode)for(var t=0,s=o.addConsumptionInfo.selectedGoodsList.length;t<s;t++)if(n.info[e].tid==o.addConsumptionInfo.selectedGoodsList[t].tid&&n.info[e].pid==o.addConsumptionInfo.selectedGoodsList[t].id){o.addConsumptionInfo.selectedGoodsList[t].tcode=n.info[e].tcccode,d.push(o.addConsumptionInfo.selectedGoodsList[t].name);break}if(0==d.length){alert("商品添加成功");o.addConsumptionInfo.userHand,o.addConsumptionInfo.userHandID;o.closeAddConsumptionView()}else{for(var i="",e=0,r=d.length;e<r;e++)i=i+d[e]+",";alert(i+"添加失败")}}else alert("发生错误，稍后再试")}).error(function(){alert("发生错误，请稍后再试")})},o.closeSelectTechnician=function(){o.cashierAlertView.addConsumptionTechnicianView=!1,o.addConsumptionInfo.selectTechnicianInfo={selectTechnicianList:[],goodsName:"",goodsID:"",goodsPrice:"",searchText:"",technicianID:"",technicianName:""}},o.changeRoomNumberInfo={roomNumber:"",roomID:"",newRoomNumber:"",newRoomID:""},o.changeRoomNumberErr={isErr:!1,errInfo:"* 房间号错误",errCode:""},o.showChangeRoomNumberView=function(){e.maskLayer=!0,o.cashierAlertView.changeRoomNumberView=!0,o.changeRoomNumberInfo.roomNumber=o.roomOccupyInfo.roomNumber,o.changeRoomNumberInfo.roomID=o.roomOccupyInfo.roomID,o.refreshRoomsData()},o.closeChangeRoomNumberView=function(){e.maskLayer=!1,o.cashierAlertView.changeRoomNumberView=!1,o.changeRoomNumberInfo={roomNumber:"",roomID:"",newRoomNumber:"",newRoomID:""},o.changeRoomNumberErr.isErr=!1,o.changeRoomNumberErr.errInfo="",o.changeRoomNumberErr.errCode=""},o.makeChangeRoomNumber=function(){console.log("调换房间发出的信息",o.changeRoomNumberInfo),""!==o.changeRoomNumberInfo.newRoomID?(o.changeRoomNumberErr={isErr:!1,errInfo:"",errCode:""},data={nowID:o.changeRoomNumberInfo.roomID,newID:o.changeRoomNumberInfo.newRoomID},n({method:"POST",url:"http://"+e.myHost+"/Home/Index/ChangeRoom",data:data,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(r){console.log("请求调换房间返回数据",r),"SUCCESS"==r.state?(alert("调换房间成功"),n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetRoomInfo",data:{roomID:o.changeRoomNumberInfo.newRoomID},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n,e){console.log("getRoomInfo",n),o.roomOccupyInfo=n;for(var r=0,t=o.roomOccupyInfo.roomHandsInfo.length;r<t;r++)o.selectHandsInfo.userHandSelected[r]=!0}).error(function(){alert("发生错误，请刷新数据")}),o.closeChangeRoomNumberView()):o.changeRoomNumberErr={isErr:!0,errInfo:"* 调换房间失败！"+r.errormsg,errCode:""}}).error(function(){alert("发生错误，请稍后再试")})):(o.changeRoomNumberErr.isErr=!0,o.changeRoomNumberErr.errInfo="* 请选择新房间号码！")},o.continueAddUserhandInfo={roomNumber:"",roomID:"",userHands:[],userHandsID:[],roomCount:"",newUserHand:"",newUserHands:[],newUserHandsID:[]},o.continueAddUserhandErr={isErr:!1,errInfo:"* 手牌号错误",errCode:""},o.showContinueAddUserhandView=function(){e.maskLayer=!0,o.cashierAlertView.continueAddUserhandView=!0,o.continueAddUserhandInfo.roomNumber=o.roomOccupyInfo.roomNumber,o.continueAddUserhandInfo.roomID=o.roomOccupyInfo.roomID,o.continueAddUserhandInfo.roomCount=o.roomOccupyInfo.roomCount,o.continueAddUserhandInfo.userHands=[];for(var n=0,r=o.roomOccupyInfo.roomHandsInfo.length;n<r;n++)o.continueAddUserhandInfo.userHands.push(o.roomOccupyInfo.roomHandsInfo[n].userHand)},o.closeContinueAddUserhandView=function(){e.maskLayer=!1,o.cashierAlertView.continueAddUserhandView=!1,o.continueAddUserhandInfo={roomNumber:"",userHands:[],userHandsID:[],roomCount:"",newUserHand:"",newUserHands:[],newUserHandsID:[]},o.continueAddUserhandErr={isErr:!1,errInfo:"* 手牌号错误",errCode:""}},o.isContinueAddUserhand=function(n){var e=window.event?n.keyCode:n.which;13==e&&(o.continueAddUserhand(),n.preventDefault?n.preventDefault():n.returnValue=!1)},o.continueAddUserhand=function(){var r=/^[a-zA-Z0-9]{1,}$/;if(!r.test(o.continueAddUserhandInfo.newUserHand))return o.continueAddUserhandErr.errInfo="* 手牌号错误",void(o.continueAddUserhandErr.isErr=!0);if(o.continueAddUserhandInfo.userHands.length+o.continueAddUserhandInfo.newUserHands.length>=0+o.continueAddUserhandInfo.roomCount)return console.log(o.continueAddUserhandInfo.userHands.length,o.continueAddUserhandInfo.newUserHands.length,o.roomUsingInfo.roomCount),o.continueAddUserhandErr.errInfo="* 房间已满，无法添加新手牌",void(o.continueAddUserhandErr.isErr=!0);for(var t=!0,s=0,d=o.continueAddUserhandInfo.userHands.length;s<d;s++)o.continueAddUserhandInfo.userHands[s]==o.continueAddUserhandInfo.newUserHand&&(t=!1);for(var s=0,d=o.continueAddUserhandInfo.newUserHands.length;s<d;s++)o.continueAddUserhandInfo.newUserHands[s]==o.continueAddUserhandInfo.newUserHand&&(t=!1);t?n({method:"POST",url:"http://"+e.myHost+"/Home/Index/CheckUserHand",data:{userHand:o.continueAddUserhandInfo.newUserHand},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n,e){console.log("获得手牌号是否能被添加",n),"SUCCESS"==n.state?(o.continueAddUserhandInfo.newUserHands.push(n.data.userHand),o.continueAddUserhandInfo.newUserHandsID.push(n.data.handid),o.continueAddUserhandErr={isErr:!1,errInfo:"* 手牌号错误",errCode:""},o.continueAddUserhandInfo.newUserHand=""):(o.continueAddUserhandErr.errInfo="* "+n.errormsg,o.continueAddUserhandErr.isErr=!0)}).error(function(){alert("发生错误，请稍后再试")}):(o.continueAddUserhandErr.errInfo="* 此手牌已被添加",o.continueAddUserhandErr.isErr=!0)},o.deleteNewUserhands=function(n){for(var e=0,r=o.continueAddUserhandInfo.newUserHands.length;e<r;e++)o.continueAddUserhandInfo.newUserHands[e]==n&&(o.continueAddUserhandInfo.newUserHands.splice(e,1),o.continueAddUserhandInfo.newUserHandsID.splice(e,1))},o.makeContinueAddUserhand=function(){if(console.log("$scope.continueAddUserhandInfo",o.continueAddUserhandInfo),0==o.continueAddUserhandInfo.newUserHands.length)return o.continueAddUserhandErr.errInfo="* 请添加手牌",o.continueAddUserhandErr.errCode="",void(o.continueAddUserhandErr.isErr=!0);var r={roomID:o.continueAddUserhandInfo.roomID,userHands:o.continueAddUserhandInfo.newUserHandsID};console.log("data",r),n({method:"POST",url:"http://"+e.myHost+"/Home/Index/RoomAddUser",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(r,t,s,d){if(console.log("增加宾客",r),"SUCCESS"==r.state){n({method:"POST",url:"http://"+e.myHost+"/Home/Index/GetRoomInfo",data:{roomID:o.continueAddUserhandInfo.roomID},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){var n=[];for(var e in o)n.push(encodeURIComponent(e)+"="+encodeURIComponent(o[e]));return n.join("&")}}).success(function(n,e){o.roomOccupyInfo=n;for(var r=0,t=o.roomOccupyInfo.roomHandsInfo.length;r<t;r++)o.selectHandsInfo.userHandSelected[r]=!0;o.isUnableClickAddConsumption()}).error(function(){});for(var i=!0,a=[],c=0,m=r.data.length;c<m;c++)"ERROR"==r.data[c].state&&(i=!1,a.push(r.data[c].handname));if(i)o.closeContinueAddUserhandView();else{o.continueAddUserhandInfo.roomNumber=o.roomOccupyInfo.roomNumber,o.continueAddUserhandInfo.roomID=o.roomOccupyInfo.roomID,o.continueAddUserhandInfo.roomCount=o.roomOccupyInfo.roomCount,o.continueAddUserhandInfo.userHands=[],o.continueAddUserhandInfo.newUserHands=[];for(var c=0,m=o.roomOccupyInfo.roomHandsInfo.length;c<m;c++)o.continueAddUserhandInfo.userHands.push(o.roomOccupyInfo.roomHandsInfo[c].userHand);o.continueAddUserhandErr.errInfo="* ";for(var c=0,m=a.length;c<m;c++)o.continueAddUserhandErr.errInfo+=a[c]+",";o.continueAddUserhandErr.errInfo+="添加失败",o.continueAddUserhandErr.isErr=!0}}}).error(function(o,n,e,r){alert("出现错误，请稍后再试")})},o.showChargebackView=function(){e.maskLayer=!0,o.cashierAlertView.chargebackView=!0},o.closeChargebackView=function(){e.maskLayer=!1,o.cashierAlertView.chargebackView=!1},o.resetCheckOutServiceInfo=function(){o.checkOutServiceInfo={titleName:"",searchPlaceholder:"",searchText:"",payWay:"",payType:"",collectMoney:"",totalMoney:"1239",changeMoney:"",selectListShow:!1,selectList:[{id:"023",name:"023"},{id:"024",name:"生的发生的生的发生的"},{id:"025",name:"025"},{id:"026",name:"026"},{id:"027",name:"027"},{id:"028",name:"028"},{id:"029",name:"029"},{id:"030",name:"030"},{id:"031",name:"031"},{id:"032",name:"032"},{id:"034",name:"034"},{id:"035",name:"035"},{id:"036",name:"036"}],selectedList:[],needPayNumber:"0"}},o.resetCheckOutServiceInfo(),o.$watch("checkOutServiceInfo.collectMoney",function(n,e,r){console.log("newValue:",n,"oldValue:",e),o.checkOutServiceInfo.changeMoney=n-o.checkOutServiceInfo.totalMoney}),o.showCheckOutServiceView=function(n){e.maskLayer=!0,o.cashierAlertView.checkOutServiceView=!0,1==n?(o.checkOutServiceInfo.titleName="房间结账",o.checkOutServiceInfo.searchPlaceholder="请输入房间号"):(o.checkOutServiceInfo.titleName="手牌结账",o.checkOutServiceInfo.searchPlaceholder="请输入手牌号")},o.closeCheckOutServiceView=function(){e.maskLayer=!1,o.cashierAlertView.checkOutServiceView=!1,o.resetCheckOutServiceInfo()},o.selectNeedPay=function(n,e){for(var r=!0,t=0,s=o.checkOutServiceInfo.selectedList.length;t<s;t++)if(o.checkOutServiceInfo.selectedList[t].id==n){r=!1;break}if(r){for(var d,t=0,s=o.checkOutServiceInfo.selectList.length;t<s;t++)if(o.checkOutServiceInfo.selectList[t].id==n){d=o.checkOutServiceInfo.selectList[t],o.checkOutServiceInfo.selectList.splice(t,1);break}o.checkOutServiceInfo.selectedList.unshift(d),o.checkOutServiceInfo.needPayNumber=o.checkOutServiceInfo.selectedList.length}},o.removeNeedPay=function(n){for(var e,r=0,t=o.checkOutServiceInfo.selectedList.length;r<t;r++)if(o.checkOutServiceInfo.selectedList[r].id==n){e=o.checkOutServiceInfo.selectedList[r],o.checkOutServiceInfo.selectedList.splice(r,1),o.checkOutServiceInfo.needPayNumber=o.checkOutServiceInfo.selectedList.length;break}o.checkOutServiceInfo.selectList.push(e)},o.selectPayType=function(n){o.checkOutServiceInfo.payType=n},o.makeCheckOutService=function(){alert(o.checkOutServiceInfo.collectMoney)}}]);
projectB.controller("FinanceController",["$scope","$http","$rootScope",function(a,t,e){a.indexPageInfo={showPage:"day-business"},a.changeFinanceSelected=function(t){a.indexPageInfo.showPage=t},a.historyBusinessInfo={goodsList:[{goodsName:"按摩",info:[{date:"10-01",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-02",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-03",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-04",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-05",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-06",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-07",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-08",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-09",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-10",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"11-11",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"12-12",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"合计",data:["900000","50.00%","-50.00%","-50.00%"]}]},{goodsName:"按摩",info:[{date:"10-01",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-02",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-03",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-04",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-05",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-06",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-07",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-08",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-09",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"10-10",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"11-11",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"12-12",data:["90000","2.00%","-2.00%","-2.00%"]},{date:"合计",data:["900000","50.00%","-50.00%","-50.00%"]}]}]},a.dayBusinessInfo={goodsList:[{goodsName:"踩背",info:[{date:"2016-10-02",data:["90000.00","20","20.00%"]}]},{goodsName:"按摩",info:[{date:"2016-10-02",data:["88880.00","26","19.00%"]}]}],allDay:{turnover:["18998.00","75557.00","23467.00","7482.00","125504.00"],recharge:["1200.00","3400.00","7878.00","/","12478.00"],total:["20198.00","78957.00","31345.00","--","130500.00"]}},a.searchDayBusinessDetail=function(){a.setDayBusinessEchartsData()},a.dayTurnoverOption={title:{text:"当日营业额支付组成"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"right",data:["现金","刷卡","微信","会员"]},series:[{name:"支付方式比例",type:"pie",radius:["0%","75%"],center:["40%","50%"],data:[]}]},a.dayTotalOption={title:{text:"当日收款支付组成"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"right",data:["现金","刷卡","微信"]},series:[{name:"支付方式比例",type:"pie",radius:["0%","75%"],center:["40%","50%"],data:[]}]},a.dayBusinessEchartsOption={title:{text:"当日营业明细"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{orient:"horizontal",right:10,data:["营业额","数量"]},grid:{left:"3%",right:"4%",bottom:"40",containLabel:!0},xAxis:[{type:"category",data:[]}],yAxis:[{type:"value",name:"营业额",min:0,position:"left",axisLabel:{formatter:"{value} 元"}},{type:"value",splitLine:{show:!1},name:"数量",min:0,position:"right"}],dataZoom:[{show:!0,height:30,xAxisIndex:[0],bottom:0,start:10,end:80,handleIcon:"path://M306.1,413c0,2.2-1.8,4-4,4h-59.8c-2.2,0-4-1.8-4-4V200.8c0-2.2,1.8-4,4-4h59.8c2.2,0,4,1.8,4,4V413z",handleSize:"110%",handleStyle:{color:"#d3dee5"},textStyle:{color:"#fff"},borderColor:"#90979c"},{type:"inside",show:!0,height:15,start:1,end:35}],series:[{name:"营业额",type:"bar",data:[]},{name:"数量",type:"bar",data:[],yAxisIndex:1}]},a.setDayBusinessEchartsData=function(){for(var t=[],e=[],s=[],d=0,o=a.dayBusinessInfo.goodsList.length;d<o;d++)t.push(a.dayBusinessInfo.goodsList[d].goodsName),e.push(a.dayBusinessInfo.goodsList[d].info[0].data[0]),s.push(a.dayBusinessInfo.goodsList[d].info[0].data[1]);a.dayBusinessEchartsOption.xAxis[0].data=t,a.dayBusinessEchartsOption.series[0].data=e,a.dayBusinessEchartsOption.series[1].data=s,console.log(a.dayBusinessEchartsOption);var n=[];n.push({value:a.dayBusinessInfo.allDay.turnover[0],name:"现金"}),n.push({value:a.dayBusinessInfo.allDay.turnover[1],name:"刷卡"}),n.push({value:a.dayBusinessInfo.allDay.turnover[2],name:"微信"}),n.push({value:a.dayBusinessInfo.allDay.turnover[3],name:"会员"}),a.dayTurnoverOption.series[0].data=n;var i=[];i.push({value:a.dayBusinessInfo.allDay.total[0],name:"现金"}),i.push({value:a.dayBusinessInfo.allDay.total[1],name:"刷卡"}),i.push({value:a.dayBusinessInfo.allDay.total[2],name:"微信"}),a.dayTotalOption.series[0].data=i}}]);
projectB.controller("GoodsController",["$scope","$http","$rootScope","fileReader",function(o,e,d,s){o.$parent.changeHeaderInfo("goodsPageIndex"),o.goodsPageShow=[!0,!1],o.goodsAlertView={addGoodsKindsView:!1},o.indexPageInfo={goodsListTitle:"全部商品",selectGoodsKind:"",allGoodsList:[],goodsKindsList:[]},o.goodsContent="goodsContentAll",o.refreshGoodsData=function(){e.post("http://"+d.myHost+"/Home/Index/GetProducts").success(function(e){console.log("获取商品数据",e),"SUCCESS"==e.state&&(o.indexPageInfo.allGoodsList=e.data)}).error(function(o){console.log(o),alert("网络故障！")})},o.refreshGoodsData(),e.post("http://"+d.myHost+"/Home/Index/GetProductCategory").success(function(e){console.log("获取商品分类列表数据",e),o.indexPageInfo.goodsKindsList=e.data}).error(function(o){console.log(o),alert("网络故障！")}),o.changeSelectGoodsKind=function(e){o.indexPageInfo.selectGoodsKind=e,o.closeEditGoodsView(),""==e?o.indexPageInfo.goodsListTitle="全部商品":o.indexPageInfo.goodsListTitle=e},o.goodsFilter=function(o){var e={};return e.catename=o,e},o.addGoodsKindsInfo={kindName:"",state:""},o.addGoodsKinds_nameErr={isErr:!1,errInfo:""},o.addGoodsKinds_needErr={isErr:!1,errInfo:""},o.showAddGoodsKindsView=function(){d.maskLayer=!0,o.goodsAlertView.addGoodsKindsView=!0},o.closeAddGoodsKindsView=function(){d.maskLayer=!1,o.goodsAlertView.addGoodsKindsView=!1,o.addGoodsKindsInfo={kindName:"",state:""},o.addGoodsKinds_nameErr={isErr:!1,errInfo:""},o.addGoodsKinds_needErr={isErr:!1,errInfo:""}},o.makeAddGoodsKinds=function(){console.log(o.addGoodsKindsInfo);var s=!0,t=/[*?:"<>\/\\\|]/;if(""==o.addGoodsKindsInfo.kindName?(o.addGoodsKinds_nameErr={isErr:!0,errInfo:"* 分类名称不能为空！"},s=!1):t.test(o.addGoodsKindsInfo.kindName)?(o.addGoodsKinds_nameErr={isErr:!0,errInfo:"* 含有非法字符！"},s=!1):o.addGoodsKinds_nameErr={isErr:!1,errInfo:""},""==o.addGoodsKindsInfo.state?(o.addGoodsKinds_needErr={isErr:!0,errInfo:"* 请选择是否需要技师！"},s=!1):o.addGoodsKinds_needErr={isErr:!1,errInfo:""},s){var i={catename:o.addGoodsKindsInfo.kindName,state:o.addGoodsKindsInfo.state};e({method:"POST",url:"http://"+d.myHost+"/Home/Index/AddProductCategory",data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){console.log("请求增加商品分类返回数据",e),"SUCCESS"==e.state?(alert("请求增加商品分类成功！"),o.closeAddGoodsKindsView()):alert("发生错误，"+e.errormsg)}).error(function(){alert("发生错误，请稍后再试")})}},o.goodsPageInfo={goodsData:{},vipPrice:[]},o.showGoodsPageInfo=function(s){e({method:"POST",url:"http://"+d.myHost+"/Home/Index/GetProductInfo",data:{id:s},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(s){console.log("请求商品详情返回数据",s),"SUCCESS"==s.state?(o.goodsPageInfo.goodsData=s.data,o.goodsPageInfo.goodsData.imageurl=o.goodsPageInfo.goodsData.imageurl.substring(1),e({method:"POST",url:"http://"+d.myHost+"/Home/Index/GetVipClass",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){if(console.log("请求会员等级列表返回数据",e),"SUCCESS"==e.state){for(var d=0,s=e.data.length;d<s;d++)for(var t=0,i=o.goodsPageInfo.goodsData.vipmoney.length;t<i;t++)if(e.data[d].id==o.goodsPageInfo.goodsData.vipmoney[t].classid){var n={vipName:e.data[d].vipname,classID:e.data[d].id,price:o.goodsPageInfo.goodsData.vipmoney[t].money};o.goodsPageInfo.vipPrice.push(n)}}else alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})):alert("发生错误，"+s.errormsg)}).error(function(){alert("发生错误，请稍后再试")}),o.goodsPageShow=[!1,!0]},o.closeGoodsPageInfo=function(){o.goodsPageShow=[!0,!1],o.goodsPageInfo={goodsData:{},vipPrice:[]}},o.changeGoodsInfo=function(){var e={goodsID:o.goodsPageInfo.goodsData.id,imageurl:o.goodsPageInfo.goodsData.imageurl,goodsName:o.goodsPageInfo.goodsData.pname,goodsKind:o.goodsPageInfo.goodsData.category,serversTime:o.goodsPageInfo.goodsData.serverstime,addTime:o.goodsPageInfo.goodsData.addtime,startTime:o.goodsPageInfo.goodsData.starttime,endTime:o.goodsPageInfo.goodsData.endtime,goodsCall:o.goodsPageInfo.goodsData.sendmsg,price:o.goodsPageInfo.goodsData.money,addPrice:o.goodsPageInfo.goodsData.addmoney,vipPrice:o.goodsPageInfo.vipPrice,goodsInfo:o.goodsPageInfo.goodsData.content};o.closeGoodsPageInfo(),o.goodsContent="goodsEdit",o.showEditGoodsView(e)},o.resetEditGoodsInfo=function(){o.editGoodsInfo={goodsID:"",title:"",imgFile:"",imageSrc:"",goodsCall:[],memberClassList:[],padList:[],imageUrl:"",goodsName:"",goodsKind:"0",serversTime:"",addTime:"",isServers:"",goodsStartTime:"",goodsEndTime:"",sendMsg:[],goodsPrice:"",addPrice:"",goodsVipPrice:[],goodsInfo:""}},o.resetEditGoodsInfo(),o.showEditGoodsView=function(s){console.log("修改商品时的goodsData",s),o.resetEditGoodsInfo(),e.post("http://"+d.myHost+"/Home/Index/GetPad").success(function(e){if(console.log("获取平板列表数据",e),"SUCCESS"==e.state)if(o.editGoodsInfo.padList=e.data,o.editGoodsInfo.sendMsg=[],s)for(var d=0,t=e.data.length;d<t;d++){for(var i=!1,n=0,r=s.goodsCall.length;n<r;n++)if(e.data[d].padname==s.goodsCall[n]){var a={name:e.data[d].padname,id:e.data[d].id,select:!0};o.editGoodsInfo.sendMsg.push(a),i=!0}if(!i){var a={name:e.data[d].padname,id:e.data[d].id,select:!1};o.editGoodsInfo.sendMsg.push(a)}}else for(var d=0,t=e.data.length;d<t;d++){var a={name:e.data[d].padname,id:e.data[d].id,select:!1};o.editGoodsInfo.sendMsg.push(a)}}).error(function(o){console.log(o),alert("网络故障！")}),e({method:"POST",url:"http://"+d.myHost+"/Home/Index/GetVipClass",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){if(console.log("请求会员等级列表返回数据",e),"SUCCESS"==e.state)if(o.editGoodsInfo.memberClassList=e.data,o.editGoodsInfo.goodsVipPrice=[],s)for(var d=0,t=e.data.length;d<t;d++){for(var i=!1,n=0,r=s.vipPrice.length;n<r;n++)if(e.data[d].id==s.vipPrice[n].classID){var a={id:e.data[d].id,vipname:e.data[d].vipname,price:s.vipPrice[n].price/100};o.editGoodsInfo.goodsVipPrice.push(a),i=!0;break}if(!i){var a={id:e.data[d].id,vipname:e.data[d].vipname,price:""};o.editGoodsInfo.goodsVipPrice.push(a)}}else for(var d=0,t=e.data.length;d<t;d++){var a={id:e.data[d].id,vipname:e.data[d].vipname,price:""};o.editGoodsInfo.goodsVipPrice.push(a)}else alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")}),s?(o.editGoodsInfo.goodsID=s.goodsID,o.editGoodsInfo.title="修改商品",o.editGoodsInfo.imageSrc=s.imageurl,o.editGoodsInfo.goodsName=s.goodsName,o.editGoodsInfo.goodsKind=s.goodsKind,o.editGoodsInfo.serversTime=s.serversTime/60,o.editGoodsInfo.addTime=s.addTime/60,o.editGoodsInfo.goodsStartTime=s.startTime,o.editGoodsInfo.goodsEndTime=s.endTime,o.editGoodsInfo.goodsPrice=s.price/100,o.editGoodsInfo.addPrice=s.addPrice/100,o.editGoodsInfo.goodsInfo=s.goodsInfo,s.serversTime>0&&(o.editGoodsInfo.isServers="2")):o.editGoodsInfo.title="添加商品"},o.selectServers=function(e){for(var d=0,s=o.indexPageInfo.goodsKindsList.length;d<s;d++)if(o.indexPageInfo.goodsKindsList[d].id==e)return void(o.editGoodsInfo.isServers=o.indexPageInfo.goodsKindsList[d].state);o.editGoodsInfo.isServers="0"},o.getFile=function(e){s.readAsDataUrl(e,o).then(function(e){o.editGoodsInfo.imageSrc=e}),o.editGoodsInfo.imgFile=e},o.makeEditGoods=function(){function s(e){for(var d=[],s=0,t=o.editGoodsInfo.sendMsg.length;s<t;s++)1==o.editGoodsInfo.sendMsg[s].select&&d.push(o.editGoodsInfo.sendMsg[s].id);for(var i=[],s=0,t=o.editGoodsInfo.goodsVipPrice.length;s<t;s++){var n={id:o.editGoodsInfo.goodsVipPrice[s].id,price:o.editGoodsInfo.goodsVipPrice[s].price};i.push(n)}if(e)var r={id:e,imageurl:o.editGoodsInfo.imageUrl,pname:$.trim(o.editGoodsInfo.goodsName),productcategory:o.editGoodsInfo.goodsKind,serverstime:$.trim(o.editGoodsInfo.serversTime),addtime:$.trim(o.editGoodsInfo.addTime),starttime:o.editGoodsInfo.goodsStartTime,endtime:o.editGoodsInfo.goodsEndTime,sendmsg:d,money:$.trim(o.editGoodsInfo.goodsPrice),addmoney:$.trim(o.editGoodsInfo.addPrice),vipmoney:i,content:o.editGoodsInfo.goodsInfo};else var r={imageurl:o.editGoodsInfo.imageUrl,pname:$.trim(o.editGoodsInfo.goodsName),productcategory:o.editGoodsInfo.goodsKind,serverstime:$.trim(o.editGoodsInfo.serversTime),addtime:$.trim(o.editGoodsInfo.addTime),starttime:o.editGoodsInfo.goodsStartTime,endtime:o.editGoodsInfo.goodsEndTime,sendmsg:d,money:$.trim(o.editGoodsInfo.goodsPrice),addmoney:$.trim(o.editGoodsInfo.addPrice),vipmoney:i,content:o.editGoodsInfo.goodsInfo};return r}if(o.editGoodsInfo.goodsID){if(o.editGoodsInfo.imgFile){if("image/jpg"!=o.editGoodsInfo.imgFile.type&&"image/png"!=o.editGoodsInfo.imgFile.type&&"image/jpeg"!=o.editGoodsInfo.imgFile.type)return void alert("图片格式不对！格式应为jpg、png、jpeg");if(o.editGoodsInfo.imgFile.size>2097152)return void alert("图片太大，2M内")}}else{if(""==o.editGoodsInfo.imgFile)return void alert("请选择商品图片");if("image/jpg"!=o.editGoodsInfo.imgFile.type&&"image/png"!=o.editGoodsInfo.imgFile.type&&"image/jpeg"!=o.editGoodsInfo.imgFile.type)return void alert("图片格式不对！格式应为jpg、png、jpeg");if(o.editGoodsInfo.imgFile.size>2097152)return void alert("图片太大，2M内")}if(""==$.trim(o.editGoodsInfo.goodsName))return void alert("请输入商品名称");var t=!1;if(o.editGoodsInfo.goodsID)var i={id:o.editGoodsInfo.goodsID,pname:$.trim(o.editGoodsInfo.goodsName)};else var i={pname:$.trim(o.editGoodsInfo.goodsName)};if($.ajax({type:"POST",async:!1,url:"http://"+d.myHost+"/Home/Index/CheckProduct",data:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(o){console.log("获取验证商品是否同名数据",o);var e=JSON.parse(o);"ERROR"==e.state&&(alert("发生错误,"+e.errormsg),t=!0)},error:function(o){console.log(o),alert("网络故障！"),t=!0}}),!t){if("0"==o.editGoodsInfo.goodsKind)return void alert("请选择商品分类");var n=/^\d{0,}$/;if("2"==o.editGoodsInfo.isServers){if(""==$.trim(o.editGoodsInfo.serversTime))return void alert("请填写服务时长");if(!n.test(o.editGoodsInfo.serversTime))return void alert("服务时长错误");if("0"==o.editGoodsInfo.serversTime)return void alert("服务时长不能为0")}else o.editGoodsInfo.serversTime="0";if("2"==o.editGoodsInfo.isServers){if(""==$.trim(o.editGoodsInfo.addTime))return void alert("请填写加钟时长");if(!n.test(o.editGoodsInfo.addTime))return void alert("加钟时长错误");if("0"==o.editGoodsInfo.addTime)return void alert("加钟时长不能为0")}else o.editGoodsInfo.addTime="0";if(""==$.trim($("#goodsStartTime").val())||""==$.trim($("#goodsEndTime").val()))return void alert("请选择供应时间");o.editGoodsInfo.goodsStartTime=$.trim($("#goodsStartTime").val()),o.editGoodsInfo.goodsEndTime=$.trim($("#goodsEndTime").val());for(var r=!1,a=0,f=o.editGoodsInfo.sendMsg.length;a<f;a++)if(1==o.editGoodsInfo.sendMsg[a].select){r=!0;break}if(!r)return void alert("请选择通知设备");if(null==$.trim(o.editGoodsInfo.goodsPrice)||""==$.trim(o.editGoodsInfo.goodsPrice)||isNaN($.trim(o.editGoodsInfo.goodsPrice)))return void alert("价格错误");if("2"==o.editGoodsInfo.isServers){if(""==$.trim(o.editGoodsInfo.addPrice))return void alert("请填写加钟价格");if(isNaN($.trim(o.editGoodsInfo.addPrice)))return void alert("加钟价格错误");if("0"==o.editGoodsInfo.addPrice)return void alert("加钟价格不能为0")}else o.editGoodsInfo.addPrice="0";for(var a=0,f=o.editGoodsInfo.goodsVipPrice.length;a<f;a++)if(null==$.trim(o.editGoodsInfo.goodsVipPrice[a].price)||""==$.trim(o.editGoodsInfo.goodsVipPrice[a].price)||isNaN($.trim(o.editGoodsInfo.goodsVipPrice[a].price)))return void alert("会员价格错误");if(""==$.trim(o.editGoodsInfo.goodsInfo))return void alert("请填写商品简介");if(o.editGoodsInfo.goodsID&&""==o.editGoodsInfo.imgFile){o.editGoodsInfo.imageUrl="."+o.editGoodsInfo.imageSrc;var g=s(o.editGoodsInfo.goodsID);console.log(g),e({method:"POST",url:"http://"+d.myHost+"/Home/Index/EditProduct",data:g,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){console.log("修改商品返回数据",e),"SUCCESS"==e.state?(alert("修改商品成功"),o.refreshGoodsData(),o.closeEditGoodsView(),o.showEditGoodsView()):alert("修改商品发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}else{var m=new FormData;m.append("image",o.editGoodsInfo.imgFile),e({method:"POST",url:"http://"+d.myHost+"/Home/Index/ImgUpload",data:m,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(t,i){if("SUCCESS"==t.state)if(o.editGoodsInfo.imageUrl=t.imgurl,o.editGoodsInfo.goodsID){var n=s(o.editGoodsInfo.goodsID);e({method:"POST",url:"http://"+d.myHost+"/Home/Index/EditProduct",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){console.log("修改商品返回数据",e),"SUCCESS"==e.state?(alert("修改商品成功"),o.refreshGoodsData(),o.closeEditGoodsView(),o.showEditGoodsView()):alert("修改商品发生错误，"+e.errormsg)}).error(function(){alert("发生错误，请稍后再试")})}else{var n=s();e({method:"POST",url:"http://"+d.myHost+"/Home/Index/AddProduct",data:n,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){console.log("添加商品返回数据",e),"SUCCESS"==e.state?(alert("添加商品成功"),o.refreshGoodsData(),o.closeEditGoodsView(),o.showEditGoodsView()):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}else alert("发生错误！请稍后再试")}).error(function(){alert("发生错误！请稍后再试")})}}},o.selectCall=function(e,d){o.editGoodsInfo.goodsCall[e]=!o.editGoodsInfo.goodsCall[e];for(var s=0,t=o.editGoodsInfo.sendMsg.length;s<t;s++)d==o.editGoodsInfo.sendMsg[s].id&&(o.editGoodsInfo.sendMsg[s].select=!o.editGoodsInfo.sendMsg[s].select)},o.closeEditGoodsView=function(){o.resetEditGoodsInfo()},o.deleteGoods=function(s){e({method:"POST",url:"http://"+d.myHost+"/Home/Index/DeleteProduct",data:{id:s},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(o){return $.param(o)}}).success(function(e){console.log("删除商品返回数据",e),"SUCCESS"==e.state?(alert("删除商品成功"),o.refreshGoodsData()):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}}]);
projectB.controller("controller",["$scope","$http","$rootScope","$location",function(e,n,o,a){function t(e){return e=e||window.event,e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!0,e.returnValue=!1),!1}function r(e){}o.myHost=a.host(),console.log(o.myHost),e.nav=[!0,!1,!1,!1,!1,!1],o.maskLayer=!1,e.headerInfo={roomPageIndex:!0,roomPageOccupy:!1,memberPageIndex:!1,memberPageInfo:!1,goodsPageIndex:!1},o.$on("$routeChangeSuccess",function(){var n,o=a.path();switch(o){case"/cashier":n=0;break;case"/technician":n=1;break;case"/finance":n=2;break;case"/member":n=3;break;case"/goods":n=4;break;case"/system":n=5}for(var t=0,r=e.nav.length;t<r;t++)n==t?e.nav[t]=!0:e.nav[t]=!1}),o.renderFinish=function(){console.log("渲染完之后的操作");var n,o=window.innerHeight,a=document.getElementById("footer");if(setTimeout(function(){n=document.getElementsByTagName("body")[0].clientHeight,n+a.offsetHeight<o?(console.log("小于",n,a.offsetHeight,o),a.style.top=o-a.offsetHeight+"px"):a.style.top=n+"px"},100),e.nav[0])try{laydate({elem:"#appointmentTime",event:"focus",format:"YYYY-MM-DD hh:mm:ss",istime:!0})}catch(e){}},e.changeHeaderInfo=function(n){angular.forEach(e.headerInfo,function(o,a,t){a==n?e.headerInfo[a]=!0:e.headerInfo[a]=!1})},e.backCashierIndex=function(){e.$broadcast("callCashierBack"),e.changeHeaderInfo("roomPageIndex")},e.backMemberIndex=function(){e.$broadcast("callMemberBack"),e.changeHeaderInfo("memberPageIndex")},o.disabledMouseWheel=function(){document.addEventListener&&document.addEventListener("DOMMouseScroll",t,!1),window.onmousewheel=document.onmousewheel=t},o.ableMouseWheel=function(){document.removeEventListener&&document.removeEventListener("DOMMouseScroll",t,!1),window.onmousewheel=document.onmousewheel=r},e.alertView={cashierHandoverView:!1},e.showCashierHandover=function(){o.maskLayer=!0,e.alertView.cashierHandoverView=!0},e.closeCashierHandover=function(){o.maskLayer=!1,e.alertView.cashierHandoverView=!1}}]);
projectB.controller("MemberController",["$scope","$http","$rootScope",function(e,r,m){e.$parent.changeHeaderInfo("memberPageIndex"),e.memberPageShow=[!0,!1],e.memberAlertView={addNewMemberView:!1,editMemberView:!1,memberRechargeView:!1,codeImageView:!1},e.memberIndexPageInfo={searchText:"",memberList:[]},e.refreshMemberData=function(){r.post("http://"+m.myHost+"/Home/Index/GetVipList").success(function(r){console.log("获取会员数据",r),"SUCCESS"==r.state?e.memberIndexPageInfo.memberList=r.data:alert("发生错误，请稍后再试")}).error(function(e){console.log(e),alert("网络故障！")})},e.refreshMemberData(),e.showMemberRechargeView=function(){m.maskLayer=!0,e.memberAlertView.memberRechargeView=!0},e.closeMemberRechargeView=function(){m.maskLayer=!1,e.memberAlertView.memberRechargeView=!1},e.resetMemberPageInfo=function(){e.memberPageInfo={info:{},memberRecords:[],classList:[]}},e.resetMemberPageInfo(),e.showMemberPageInfo=function(n){e.memberPageShow[0]=!1,e.memberPageShow[1]=!0,e.$parent.changeHeaderInfo("memberPageInfo"),r({method:"POST",url:"http://"+m.myHost+"/Home/Index/GetVipClass",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(o){console.log("请求会员等级返回数据",o),"SUCCESS"==o.state?r({method:"POST",url:"http://"+m.myHost+"/Home/Index/GetVipInfo",data:{id:n},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(r){if(console.log("请求会员详情信息返回数据",r),"SUCCESS"==r.state){e.memberPageInfo.info=r.data,e.memberPageInfo.memberRecords=r.info;for(var m=0,n=o.data.length;m<n;m++)if(o.data[m].id==e.memberPageInfo.info.classid){e.memberPageInfo.info.className=o.data[m].vipname;break}}else alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")}):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})},e.$on("callMemberBack",function(){e.memberPageShow=[!0,!1],e.refreshMemberData(),e.resetMemberPageInfo()}),e.resetChangeMemberInfo=function(){e.changeMemberInfo={memberName:"",memberID:"",memberTel:"",memberWeixin:"",memberSex:"",memberBirthday:"",memberClass:"0",memberClassList:[]}},e.resetChangeMemberInfo(),e.resetChangeMemberErrInfo=function(){e.changeMemberErrInfo={nameErr:{isErr:!1,errInfo:""},telErr:{isErr:!1,errInfo:""},weixinErr:{isErr:!1,errInfo:""},sexErr:{isErr:!1,errInfo:""},birthdayErr:{isErr:!1,errInfo:""},classErr:{isErr:!1,errInfo:""}}},e.resetChangeMemberErrInfo(),e.showEditMemberView=function(n){m.maskLayer=!0,e.memberAlertView.editMemberView=!0,m.disabledMouseWheel(),r({method:"POST",url:"http://"+m.myHost+"/Home/Index/GetVipClass",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(r){if(console.log("请求会员等级列表返回数据",r),"SUCCESS"==r.state){e.changeMemberInfo.memberClassList=r.data,e.changeMemberInfo.memberName=e.memberPageInfo.info.names,e.changeMemberInfo.memberTel=e.memberPageInfo.info.phone,e.changeMemberInfo.memberWeixin=e.memberPageInfo.info.wechat,e.changeMemberInfo.memberSex=e.memberPageInfo.info.sex;var m="",o="",a="",t=e.memberPageInfo.info.birthday;t*=1e3;var i=new Date;i.setTime(t),m=i.getFullYear(),o=i.getMonth()+1,a=i.getDate(),e.changeMemberInfo.memberBirthday=m+"-"+o+"-"+a,e.changeMemberInfo.memberClass=e.memberPageInfo.info.classid,e.changeMemberInfo.memberID=n,console.log(e.changeMemberInfo)}else alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})},e.makeChangeMember=function(){var n=!1;e.resetChangeMemberErrInfo(),e.changeMemberInfo.memberBirthday=$("#changeMember_Birthday").val(),""==$.trim(e.changeMemberInfo.memberName)&&(e.changeMemberErrInfo.nameErr.isErr=!0,e.changeMemberErrInfo.nameErr.errInfo="* 不能为空",n=!0);var o=/^1\d{10}$/;""==$.trim(e.changeMemberInfo.memberTel)?(e.changeMemberErrInfo.telErr.isErr=!0,e.changeMemberErrInfo.telErr.errInfo="* 不能为空",n=!0):o.test(e.changeMemberInfo.memberTel)||(e.changeMemberErrInfo.telErr.isErr=!0,e.changeMemberErrInfo.telErr.errInfo="* 格式错误",n=!0);""==$.trim(e.changeMemberInfo.memberWeixin)?(e.changeMemberErrInfo.weixinErr.isErr=!0,e.changeMemberErrInfo.weixinErr.errInfo="* 不能为空",n=!0):/^[a-zA-Z]{1}[-_a-zA-Z0-9]{5,19}$/.test($.trim(e.changeMemberInfo.memberWeixin))||/^1\d{10}$/.test($.trim(e.changeMemberInfo.memberWeixin))||(e.changeMemberErrInfo.weixinErr.isErr=!0,e.changeMemberErrInfo.weixinErr.errInfo="* 格式错误",n=!0),""==e.changeMemberInfo.memberSex&&(e.changeMemberErrInfo.sexErr.isErr=!0,e.changeMemberErrInfo.sexErr.errInfo="* 请选择性别",n=!0),""==$.trim(e.changeMemberInfo.memberBirthday)&&(e.changeMemberErrInfo.birthdayErr.isErr=!0,e.changeMemberErrInfo.birthdayErr.errInfo="* 请选择出生日期",n=!0),"0"==e.changeMemberInfo.memberClass&&(e.changeMemberErrInfo.classErr.isErr=!0,e.changeMemberErrInfo.classErr.errInfo="* 请选择会员等级",n=!0),n||r({method:"POST",url:"http://"+m.myHost+"/Home/Index/CheckVipPhone",data:{id:e.changeMemberInfo.memberID,phone:e.changeMemberInfo.memberTel},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){if(console.log("检测会员手机是否重复返回数据",n),"SUCCESS"==n.state){var o={id:e.changeMemberInfo.memberID,names:$.trim(e.changeMemberInfo.memberName),phone:$.trim(e.changeMemberInfo.memberTel),wechat:$.trim(e.changeMemberInfo.memberWeixin),sex:e.changeMemberInfo.memberSex,birthday:$.trim(e.changeMemberInfo.memberBirthday),classid:e.changeMemberInfo.memberClass};r({method:"POST",url:"http://"+m.myHost+"/Home/Index/EditStoreVip",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(r){console.log("发送修改数据的返回数据",r),"SUCCESS"==r.state&&(alert("修改成功"),e.showMemberPageInfo(e.changeMemberInfo.memberID),e.closeEditMemberView())}).error(function(){alert("发生错误，请稍后再试")})}else"ERROR"==n.state?(e.changeMemberErrInfo.telErr.isErr=!0,e.changeMemberErrInfo.telErr.errInfo="* "+n.errormsg):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})},e.closeEditMemberView=function(){m.maskLayer=!1,e.memberAlertView.editMemberView=!1,m.ableMouseWheel(),e.resetChangeMemberInfo()},e.changeMemberSex=function(r){e.changeMemberInfo.memberSex=r},e.resetAddNewMemberInfo=function(){e.addNewMemberInfo={memberID:"",memberName:"",memberTel:"",memberWeixin:"",memberSex:"",memberBirthday:"",memberClass:"0",memberClassList:[]}},e.resetAddNewMemberInfo(),e.resetAddNewMemberErrInfo=function(){e.addNewMemberErrInfo={nameErr:{isErr:!1,errInfo:""},telErr:{isErr:!1,errInfo:""},weixinErr:{isErr:!1,errInfo:""},sexErr:{isErr:!1,errInfo:""},birthdayErr:{isErr:!1,errInfo:""},classErr:{isErr:!1,errInfo:""}}},e.resetAddNewMemberErrInfo(),e.showAddNewMemberView=function(){m.maskLayer=!0,e.memberAlertView.addNewMemberView=!0,m.disabledMouseWheel(),r({method:"POST",url:"http://"+m.myHost+"/Home/Index/GetVipClass",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(r){console.log("请求会员等级列表返回数据",r),"SUCCESS"==r.state?e.addNewMemberInfo.memberClassList=r.data:alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})},e.closeAddNewMemberView=function(){m.maskLayer=!1,e.memberAlertView.addNewMemberView=!1,m.ableMouseWheel(),e.resetAddNewMemberInfo(),e.resetAddNewMemberErrInfo()},e.selectMemberSex=function(r){e.addNewMemberInfo.memberSex=r},e.makeAddNewMember=function(){var n=!1;e.resetAddNewMemberErrInfo(),e.addNewMemberInfo.memberBirthday=$("#addMember_Birthday").val(),""==$.trim(e.addNewMemberInfo.memberName)&&(e.addNewMemberErrInfo.nameErr.isErr=!0,e.addNewMemberErrInfo.nameErr.errInfo="* 不能为空",n=!0);var o=/^1\d{10}$/;""==$.trim(e.addNewMemberInfo.memberTel)?(e.addNewMemberErrInfo.telErr.isErr=!0,e.addNewMemberErrInfo.telErr.errInfo="* 不能为空",n=!0):o.test(e.addNewMemberInfo.memberTel)||(e.addNewMemberErrInfo.telErr.isErr=!0,e.addNewMemberErrInfo.telErr.errInfo="* 格式错误",n=!0);if(""==$.trim(e.addNewMemberInfo.memberWeixin)?(e.addNewMemberErrInfo.weixinErr.isErr=!0,e.addNewMemberErrInfo.weixinErr.errInfo="* 不能为空",n=!0):/^[a-zA-Z]{1}[-_a-zA-Z0-9]{5,19}$/.test($.trim(e.addNewMemberInfo.memberWeixin))||/^1\d{10}$/.test($.trim(e.addNewMemberInfo.memberWeixin))||(e.addNewMemberErrInfo.weixinErr.isErr=!0,e.addNewMemberErrInfo.weixinErr.errInfo="* 格式错误",n=!0),""==e.addNewMemberInfo.memberSex&&(e.addNewMemberErrInfo.sexErr.isErr=!0,e.addNewMemberErrInfo.sexErr.errInfo="* 请选择性别",n=!0),""==$.trim(e.addNewMemberInfo.memberBirthday)&&(e.addNewMemberErrInfo.birthdayErr.isErr=!0,e.addNewMemberErrInfo.birthdayErr.errInfo="* 请选择出生日期",n=!0),"0"==e.addNewMemberInfo.memberClass&&(e.addNewMemberErrInfo.classErr.isErr=!0,e.addNewMemberErrInfo.classErr.errInfo="* 请选择会员等级",n=!0),!n){var a={names:$.trim(e.addNewMemberInfo.memberName),phone:$.trim(e.addNewMemberInfo.memberTel),wechat:$.trim(e.addNewMemberInfo.memberWeixin),sex:e.addNewMemberInfo.memberSex,birthday:$.trim(e.addNewMemberInfo.memberBirthday),classid:e.addNewMemberInfo.memberClass};console.log(a),r({method:"POST",url:"http://"+m.myHost+"/Home/Index/AddStoreVip",data:a,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(r){console.log("请求添加新会员返回数据",r),"SUCCESS"==r.state?(e.memberAlertView.codeImageView=!0,e.addNewMemberInfo.memberID=r.id,e.getMemberCode(r.id)):"ERROR"==r.state&&"1"==r.errorcode?(e.addNewMemberErrInfo.telErr.isErr=!0,e.addNewMemberErrInfo.telErr.errInfo="* 已被注册"):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}};var n;e.getMemberCode=function(){setTimeout(function(){$("#memberCodeImage").attr("src","http://"+m.myHost+"/Home/Index/VipBindingWechat?"+Math.random())},1);var o=0;n=setInterval(function(){o++,o>90&&(e.memberAlertView.codeImageView=!1,clearInterval(n),e.closeMemberCodeImageView()),o%30==0&&$("#memberCodeImage").attr("src","http://"+m.myHost+"/Home/Index/VipBindingWechat?"+Math.random()),r.post("http://"+m.myHost+"/Home/Index/CheckVipBinding").success(function(r){console.log("获取会员绑定情况",r.state),"SUCCESS"==r.state&&(e.memberAlertView.codeImageView=!1,clearInterval(n),alert("会员添加成功"),e.memberAlertView.codeImageView=!1,e.closeAddNewMemberView(),e.refreshMemberData())}).error(function(e){console.log("获取技师绑定情况发生错误",e)})},2e3)},e.closeMemberCodeImageView=function(){var o=e.addNewMemberInfo.memberID;r({method:"POST",url:"http://"+m.myHost+"/Home/Index/DeleteStoreVip",data:{id:o},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log("请求删除刚添加的会员返回数据",e),"SUCCESS"==e.state&&alert("未绑定二维码，添加会员失败")}).error(function(){}),clearInterval(n),e.memberAlertView.codeImageView=!1,e.refreshMemberData()}}]);
projectB.controller("SystemController",["$scope","$http","$rootScope",function(d,a,r){d.$parent.changeHeaderInfo("systemPageIndex"),d.systemAlertView={addPadView:!1,delPadView:!1},d.systemPadInfo={padList:[]},d.getPadList=function(){a.post("http://"+r.myHost+"/Home/Index/GetPad").success(function(a){console.log("获取平板列表数据",a),d.systemPadInfo.padList=a.data}).error(function(d){console.log(d),alert("网络故障！")})},d.getPadList(),d.addPadInfo={padName:"",padRepassword:"",padPassword:""},d.addPad_nameErr={isErr:!1,errInfo:"",errCode:""},d.addPad_repasswordErr={isErr:!1,errInfo:"",errCode:""},d.addPad_passwordErr={isErr:!1,errInfo:"",errCode:""},d.showAddPadView=function(){r.maskLayer=!0,d.systemAlertView.addPadView=!0},d.makeAddPad=function(){var e=/[*?:"<>\/\\\|]/,o=!0;""==d.addPadInfo.padName?(d.addPad_nameErr={isErr:!0,errInfo:"* 名称不能为空！"},o=!1):e.test(d.addPadInfo.padName)?(d.addPad_nameErr={isErr:!0,errInfo:"* 含有非法字符！"},o=!1):d.addPad_nameErr={isErr:!1,errInfo:""};var s=/^[a-zA-Z0-9]{6,16}$/;""==d.addPadInfo.padPassword?(d.addPad_passwordErr={isErr:!0,errInfo:"* 密码不能为空！"},o=!1):s.test(d.addPadInfo.padPassword)?d.addPad_passwordErr={isErr:!1,errInfo:""}:(d.addPad_passwordErr={isErr:!0,errInfo:"* 数字,字符6-16位！"},o=!1),d.addPadInfo.padPassword!=d.addPadInfo.padRepassword?(d.addPad_repasswordErr={isErr:!0,errInfo:"* 密码不一致！"},o=!1):d.addPad_repasswordErr={isErr:!1,errInfo:""},o&&(data={padname:d.addPadInfo.padName,password:d.addPadInfo.padPassword},a({method:"POST",url:"http://"+r.myHost+"/Home/Index/AddPad",data:data,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(d){return $.param(d)}}).success(function(a){console.log("请求增加平板返回数据",a),"SUCCESS"==a.state?(alert("添加平板成功"),d.getPadList(),d.closeAddPadView()):d.addPad_nameErr={isErr:!0,errInfo:"* "+a.errormsg}}).error(function(){alert("发生错误，请稍后再试")}))},d.closeAddPadView=function(){r.maskLayer=!1,d.systemAlertView.addPadView=!1,d.addPadInfo={padName:"",padTel:"",padPassword:""},d.addPad_nameErr={isErr:!1,errInfo:"",errCode:""},d.addPad_telErr={isErr:!1,errInfo:"",errCode:""},d.addPad_passwordErr={isErr:!1,errInfo:"",errCode:""}},d.delPadInfo={padID:"",padName:""},d.showDelPadView=function(a,e){r.maskLayer=!0,d.systemAlertView.delPadView=!0,d.delPadInfo={padID:a,padName:e}},d.closeDelPadView=function(){r.maskLayer=!1,d.systemAlertView.delPadView=!1,d.delPadInfo={padID:"",padName:""}},d.makeDelPad=function(){var e={id:d.delPadInfo.padID};a({method:"POST",url:"http://"+r.myHost+"/Home/Index/DeletePad",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(d){return $.param(d)}}).success(function(a){console.log("请求删除平板返回数据",a),"SUCCESS"==a.state&&(alert("删除平板成功"),d.getPadList(),d.closeDelPadView())}).error(function(){alert("发生错误，请稍后再试")})}}]);
projectB.controller("TechnicianController",["$scope","$http","$rootScope","fileReader",function(e,n,i,t){e.$parent.changeHeaderInfo("technicianPageIndex"),e.technicianPageShow=[!0,!1],e.technicianContent="technicianContentAll",e.technicianAlertView={addTechnicianKinds:!1,codeImageView:!1,delTechnicianView:!1},e.technicianIndexPageInfo={listTitle:"全部技师",searchText:"",searchState:"",kindsList:[{id:"1",name:"空闲"},{id:"2",name:"忙碌"},{id:"3",name:"请假"},{id:"4",name:"锁定"}],technicianList:[]},e.refreshTechnicianData=function(){n({method:"POST",url:"http://"+i.myHost+"/Home/Index/GetTccList",data:{},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){console.log("获取技师列表数据",n),"SUCCESS"==n.state?e.technicianIndexPageInfo.technicianList=n.data:alert("发生错误，"+n.errormsg)}).error(function(e){console.log(e),alert("网络故障！")})},e.refreshTechnicianData(),e.changeTechnicianSelect=function(n,i){e.technicianIndexPageInfo.searchState=n,e.technicianIndexPageInfo.listTitle=i},e.filterTechnician=function(){var n={names:e.technicianIndexPageInfo.searchText,state:e.technicianIndexPageInfo.searchState};return n},e.showAddTechnicianKindsView=function(){i.maskLayer=!0,e.technicianAlertView.addTechnicianKinds=!0},e.closeAddTechnicianKindsView=function(){i.maskLayer=!1,e.technicianAlertView.addTechnicianKinds=!1},e.resetTechnicianPageInfo=function(){e.technicianPageInfo={technicianID:"",techInfo:"",techRecord:[]}},e.resetTechnicianPageInfo(),e.showTechnicianPageInfo=function(t){e.technicianPageInfo.technicianID=t,e.technicianPageShow=[!1,!0],n({method:"POST",url:"http://"+i.myHost+"/Home/Index/GetTccInfo",data:{id:e.technicianPageInfo.technicianID},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){console.log("请求技师详情返回数据",n),"SUCCESS"==n.state?(e.technicianPageInfo.techInfo=n.tccinfo,e.technicianPageInfo.techRecord=n.record,e.technicianPageInfo.techInfo.imageurl=e.technicianPageInfo.techInfo.imageurl.substring(1)):alert("发生错误，请稍后再试")}).error(function(e){alert("网络错误，请稍后再试")})},e.closeTechnicianPageInfo=function(){e.technicianPageShow=[!0,!1],e.technicianContent="technicianContentAll",e.resetTechnicianPageInfo()},e.delTechnicianInfo={name:"",id:"",number:""},e.deleteTechnician=function(n,t,c){i.maskLayer=!0,e.technicianAlertView.delTechnicianView=!0,e.delTechnicianInfo={name:t,id:n,number:c}},e.makeDelTechnician=function(){n({method:"POST",url:"http://"+i.myHost+"/Home/Index/TccDelete",data:{id:e.delTechnicianInfo.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){"SUCCESS"==n.state?(alert(e.delTechnicianInfo.name+" 技师删除成功"),e.closeDelTechnicianView(),e.refreshTechnicianData()):alert("发生错误，请稍后再试")}).error(function(e){alert("网络错误，请稍后再试")})},e.closeDelTechnicianView=function(){i.maskLayer=!1,e.technicianAlertView.delTechnicianView=!1,e.delTechnicianInfo={name:"",id:"",number:""}},e.changeTechnicianInfo=function(){var n={technicianID:e.technicianPageInfo.technicianID,imageurl:e.technicianPageInfo.techInfo.imageurl,name:e.technicianPageInfo.techInfo.names,sex:e.technicianPageInfo.techInfo.sex,number:e.technicianPageInfo.techInfo.number,tel:e.technicianPageInfo.techInfo.phone,weixin:e.technicianPageInfo.techInfo.wechat,birthday:e.technicianPageInfo.techInfo.birthday,skill:e.technicianPageInfo.techInfo.category,lock:e.technicianPageInfo.techInfo.state,intro:e.technicianPageInfo.techInfo.content};e.technicianPageShow=[!0,!1],e.technicianContent="technicianEdit",e.showEditTechnicianView(n)},e.resetEditTechnicianInfo=function(){e.editTechnicianInfo={technicianID:"",titleName:"",imgFile:"",imageSrc:"",imageUrl:"",name:"",sex:"",number:"",tel:"",weixin:"",birthday:"",skill:[],lock:"0",intro:"",codeImage:"",codeImageShow:!1}},e.resetEditTechnicianInfo(),e.showEditTechnicianView=function(t){if(e.resetEditTechnicianInfo(),n({method:"POST",url:"http://"+i.myHost+"/Home/Index/GetProductCategory",data:{state:"2"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){if(console.log("请求技师服务列表的返回数据",n),"SUCCESS"==n.state)if(e.editTechnicianInfo.skill=[],t)for(var i=0,c=n.data.length;i<c;i++){for(var a=!1,o=0,r=t.skill.length;o<r;o++)if(n.data[i].id==t.skill[o]){var h={id:n.data[i].id,name:n.data[i].catename,select:!0};a=!0,e.editTechnicianInfo.skill.push(h)}if(!a){var h={id:n.data[i].id,name:n.data[i].catename,select:!1};e.editTechnicianInfo.skill.push(h)}}else for(var i=0,c=n.data.length;i<c;i++){var h={id:n.data[i].id,name:n.data[i].catename,select:!1};e.editTechnicianInfo.skill.push(h)}else alert("发生错误")}).error(function(){alert("发生错误，请稍后再试")}),t){var c=new Date;c.setTime(1e3*t.birthday);var a=c.getFullYear(),o=c.getMonth()+1,r=c.getDate(),h=a+"-"+o+"-"+r;e.editTechnicianInfo.titleName="修改技师信息",e.editTechnicianInfo.technicianID=t.technicianID,e.editTechnicianInfo.imageSrc=t.imageurl,e.editTechnicianInfo.name=t.name,e.editTechnicianInfo.sex=t.sex,e.editTechnicianInfo.number=t.number,e.editTechnicianInfo.tel=t.tel,e.editTechnicianInfo.weixin=t.weixin,e.editTechnicianInfo.birthday=h,e.editTechnicianInfo.lock="4"==t.lock?"4":"1",e.editTechnicianInfo.intro=t.intro}else e.editTechnicianInfo.titleName="添加技师"},e.makeEditTechnician=function(){function t(n){for(var i=[],t=0,c=e.editTechnicianInfo.skill.length;t<c;t++)1==e.editTechnicianInfo.skill[t].select&&i.push(e.editTechnicianInfo.skill[t].id);if(n)var a={id:n,imageurl:e.editTechnicianInfo.imageUrl,names:$.trim(e.editTechnicianInfo.name),sex:e.editTechnicianInfo.sex,phone:e.editTechnicianInfo.tel,wechat:e.editTechnicianInfo.weixin,birthday:e.editTechnicianInfo.birthday,content:e.editTechnicianInfo.intro,category:i,number:$.trim(e.editTechnicianInfo.number),state:e.editTechnicianInfo.lock};else var a={imageurl:e.editTechnicianInfo.imageUrl,names:$.trim(e.editTechnicianInfo.name),sex:e.editTechnicianInfo.sex,phone:e.editTechnicianInfo.tel,wechat:e.editTechnicianInfo.weixin,birthday:e.editTechnicianInfo.birthday,content:e.editTechnicianInfo.intro,category:i,number:$.trim(e.editTechnicianInfo.number),state:e.editTechnicianInfo.lock};return a}if(e.editTechnicianInfo.technicianID){if(e.editTechnicianInfo.imgFile){if("image/jpg"!=e.editTechnicianInfo.imgFile.type&&"image/png"!=e.editTechnicianInfo.imgFile.type&&"image/jpeg"!=e.editTechnicianInfo.imgFile.type)return void alert("图片格式不对！格式应为jpg、png、jpeg");if(e.editTechnicianInfo.imgFile.size>2097152)return void alert("图片太大，2M内")}}else{if(""==e.editTechnicianInfo.imgFile)return void alert("请选择上传图片");if("image/jpg"!=e.editTechnicianInfo.imgFile.type&&"image/png"!=e.editTechnicianInfo.imgFile.type&&"image/jpeg"!=e.editTechnicianInfo.imgFile.type)return void alert("图片格式不对！格式应为jpg、png、jpeg");if(e.editTechnicianInfo.imgFile.size>2097152)return void alert("图片太大，2M内")}if(""==$.trim(e.editTechnicianInfo.name))return void alert("请输入技师名称");if(""==$.trim(e.editTechnicianInfo.sex))return void alert("请选择技师性别");var c=/^[a-zA-Z0-9]{1,}$/;if(""==$.trim(e.editTechnicianInfo.number))return void alert("请填写技师编号");if(!c.test(e.editTechnicianInfo.number))return void alert("技师编号格式错误，只能数字和字母");var a=!1;if(e.editTechnicianInfo.technicianID)var o={id:e.editTechnicianInfo.technicianID,number:$.trim(e.editTechnicianInfo.number)};else var o={number:$.trim(e.editTechnicianInfo.number)};if($.ajax({type:"POST",async:!1,url:"http://"+i.myHost+"/Home/Index/CheckTccNumber",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},success:function(e){console.log("验证技师号码是否被占用",e);var n=JSON.parse(e);"ERROR"==n.state&&(alert("发生错误,"+n.errormsg),a=!0)},error:function(e){console.log(e),alert("网络故障！"),a=!0}}),!a){var r=/^1\d{10}$/;if(!r.test(e.editTechnicianInfo.tel))return void alert("手机号码填写错误");if(""==$.trim(e.editTechnicianInfo.weixin))return void alert("请填写微信号");if(!/^[a-zA-Z]{1}[-_a-zA-Z0-9]{5,19}$/.test($.trim(e.editTechnicianInfo.weixin))&&!/^1\d{10}$/.test($.trim(e.editTechnicianInfo.weixin)))return void alert("微信号错误");if(""==$.trim($("#technicianBirthday").val()))return void alert("请选择技师出生日期");e.editTechnicianInfo.birthday=$.trim($("#technicianBirthday").val());for(var h=!1,d=0,f=e.editTechnicianInfo.skill.length;d<f;d++)if(e.editTechnicianInfo.skill[d].select){h=!0;break}if(!h)return void alert("请选择技师服务");if("0"==e.editTechnicianInfo.lock)return void alert("请选择是否锁定技师");if(""==$.trim(e.editTechnicianInfo.intro))return void alert("请填写技师简介");if(e.editTechnicianInfo.technicianID&&""==e.editTechnicianInfo.imgFile){e.editTechnicianInfo.imageUrl="."+e.editTechnicianInfo.imageSrc;var l=t(e.editTechnicianInfo.technicianID);console.log(l),n({method:"POST",url:"http://"+i.myHost+"/Home/Index/EditTcc",data:l,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){console.log("修改技师返回数据",n),"SUCCESS"==n.state&&"1"==n.code?e.getTechnicianCode():"SUCCESS"==n.state&&"1"!=n.code?(alert("修改技师信息成功"),e.refreshTechnicianData(),e.closeEditTechnicianView(),e.technicianContent="technicianContentAll",e.showTechnicianPageInfo(e.technicianPageInfo.technicianID)):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}else{var s=new FormData;s.append("image",e.editTechnicianInfo.imgFile),n({method:"POST",url:"http://"+i.myHost+"/Home/Index/ImgUpload",data:s,headers:{"Content-Type":void 0},transformRequest:angular.identity}).success(function(c,a){if("SUCCESS"==c.state)if(e.editTechnicianInfo.imageUrl=c.imgurl,e.editTechnicianInfo.technicianID){var o=t(e.editTechnicianInfo.technicianID);n({method:"POST",url:"http://"+i.myHost+"/Home/Index/EditTcc",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){console.log("修改技师(修改了图片)返回数据",n),"SUCCESS"==n.state&&"1"==n.code?e.getTechnicianCode():"SUCCESS"==n.state&&"1"!=n.code?(alert("修改技师信息成功"),e.refreshTechnicianData(),e.closeEditTechnicianView(),e.showEditTechnicianView()):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}else{var o=t();n({method:"POST",url:"http://"+i.myHost+"/Home/Index/AddTcc",data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(n){console.log("添加技师信息返回数据",n),"SUCCESS"==n.state&&"1"==n.code?e.getTechnicianCode():"SUCCESS"==n.state&&"1"!=n.code?(alert("新增技师成功,该技师为锁定状态"),e.refreshTechnicianData(),e.closeEditTechnicianView(),e.showEditTechnicianView()):alert("发生错误，请稍后再试")}).error(function(){alert("发生错误，请稍后再试")})}else alert("发生错误！请稍后再试")}).error(function(){alert("发生错误！请稍后再试")})}console.log(e.editTechnicianInfo)}},e.getTechnicianCode=function(){i.maskLayer=!0,e.technicianAlertView.codeImageView=!0,e.editTechnicianInfo.codeImageShow=!0;var t=0;setTimeout(function(){$("#technicianCodeImage").attr("src","http://"+i.myHost+"/Home/Index/TccBindingWechat?"+Math.random())},10),c=setInterval(function(){t++,t>90&&e.closeCodeImageView(),t%30==0&&$("#technicianCodeImage").attr("src","http://"+i.myHost+"/Home/Index/TccBindingWechat?"+Math.random()),n.post("http://"+i.myHost+"/Home/Index/CheckTccBinding").success(function(n){console.log("获取技师绑定情况",n.state),"SUCCESS"==n.state&&e.closeCodeImageView(n.state)}).error(function(e){console.log("获取技师绑定情况发生错误",e)})},2e3)},e.getFile=function(n){t.readAsDataUrl(n,e).then(function(n){e.editTechnicianInfo.imageSrc=n}),e.editTechnicianInfo.imgFile=n},e.closeEditTechnicianView=function(){e.resetEditTechnicianInfo()},e.selectTechnicianSex=function(n){e.editTechnicianInfo.sex=n},e.selectTechnicianSkill=function(n){for(var i=0,t=e.editTechnicianInfo.skill.length;i<t;i++)n==e.editTechnicianInfo.skill[i].id&&(e.editTechnicianInfo.skill[i].select=!e.editTechnicianInfo.skill[i].select)};var c;e.closeCodeImageView=function(n){clearInterval(c),i.maskLayer=!1,e.technicianAlertView.codeImageView=!1,e.refreshTechnicianData(),e.closeEditTechnicianView(),e.showEditTechnicianView(),"SUCCESS"==n?alert("技师添加成功，微信绑定成功"):alert("技师添加成功，微信绑定失败")}}]);